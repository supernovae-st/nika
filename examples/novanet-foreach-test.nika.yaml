# NovaNet for_each Integration Test
#
# Tests for_each parallelism with real NovaNet MCP server.
# Queries multiple entities in parallel to verify MCP invoke + for_each works.
#
# Usage:
#   cargo run -- run examples/novanet-foreach-test.nika.yaml

schema: "nika/workflow@0.3"
provider: mock

mcp:
  novanet:
    command: /Users/thibaut/supernovae-st/supernovae-agi/novanet-dev/tools/novanet-mcp/target/release/novanet-mcp
    args: []
    env:
      NOVANET_MCP_NEO4J_URI: bolt://localhost:7687
      NOVANET_MCP_NEO4J_USER: neo4j
      NOVANET_MCP_NEO4J_PASSWORD: novanetpassword
      RUST_LOG: info

tasks:
  # Query NovaNet for entities matching different patterns in parallel
  - id: search_entities
    for_each: ["qr", "api", "url", "web", "app"]
    as: pattern
    invoke:
      mcp: novanet
      tool: novanet_query
      params:
        cypher: "MATCH (e:Entity) WHERE e.slug CONTAINS '{{use.pattern}}' RETURN e.slug AS slug LIMIT 3"
