# v0.1 Demo: use: block + output: policy
#
# DAG: weather + flights -> recommend
#
# Unified use: syntax:
#   alias: task.path [?? default]
#
schema: "nika/workflow@0.1"

provider: mock
model: gpt-4o-mini

tasks:
  # =========================================================================
  # Data sources with JSON output
  # =========================================================================

  - id: weather
    infer:
      prompt: |
        Return weather as JSON:
        {"city": "Paris", "summary": "Sunny", "temp": 25}
    output:
      format: json

  - id: flights
    infer:
      prompt: |
        Return flights as JSON:
        {"cheapest": {"price": 89, "airline": "Ryanair"}}
    output:
      format: json

  # =========================================================================
  # Recommendation using unified use: syntax
  # =========================================================================

  - id: recommend
    use:
      # Simple path
      forecast: weather.summary
      city: weather.city
      temp: weather.temp

      # Nested paths
      price: flights.cheapest.price
      airline: flights.cheapest.airline

      # With default values
      rating: weather.rating ?? 5
      notes: 'weather.notes ?? "No notes available"'
      config: 'weather.config ?? {"debug": false}'

    infer:
      prompt: |
        # Travel to {{use.city}}

        Weather: {{use.forecast}} ({{use.temp}} C)
        Rating: {{use.rating}}/5
        Notes: {{use.notes}}

        Flight: {{use.airline}} for ${{use.price}}

        Create a recommendation.

    output:
      format: json

flows:
  - source: [weather, flights]
    target: recommend
