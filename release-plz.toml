# release-plz configuration for Nika
# https://release-plz.ieni.dev/docs/config

[workspace]
# Allow release-plz to release new versions
allow_dirty = false
# Path to changelog
changelog_path = "CHANGELOG.md"
# Update dependencies in Cargo.toml (but don't publish to crates.io)
dependencies_update = true
# Generate changelog using git-cliff
git_cliff_config = "../cliff.toml"
# Create GitHub releases
git_release_enable = true
# Draft releases for review before publishing
git_release_draft = false
# Use release type based on conventional commits
release_commits = "^(feat|fix|docs|perf|refactor|style|test|chore)(\\([a-z-]+\\))?!?:"

[changelog]
# Use Keep a Changelog format
body = """
{% if version %}\
    ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
{% else %}\
    ## [Unreleased]
{% endif %}\
{% for group, commits in commits | group_by(attribute="group") %}
    ### {{ group | striptags | trim | upper_first }}
    {% for commit in commits %}
        - {% if commit.scope %}**{{ commit.scope }}:** {% endif %}{{ commit.message | upper_first }}\
    {% endfor %}
{% endfor %}\n
"""
# Protect breaking changes from being skipped
protect_breaking_commits = true
# Link to commits
commit_preprocessors = [
    { pattern = "\\(#([0-9]+)\\)", replace = "([#$1](https://github.com/supernovae-st/nika-dev/pull/$1))" },
]

# Main Nika CLI package
[[package]]
name = "nika"
# Path to the crate changelog
changelog_path = "tools/nika/CHANGELOG.md"
# Publish to crates.io (disabled for now)
publish = false
# Semver check
semver_check = true
# Git tag format
git_tag_name = "v{{ version }}"
# Git tag message
git_tag_message = "Nika {{ version }}"

# Version compatibility requirements
[package.version_requirements]
# Minimum NovaNet MCP version required
novanet_mcp = ">=0.13.0"
