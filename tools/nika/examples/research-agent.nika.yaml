# Research Agent Workflow
#
# Comprehensive web research using multiple MCP tools.
# Combines Perplexity search, Firecrawl scraping, and Supadata transcripts.
#
# Run with: cargo run -- run examples/research-agent.nika.yaml
#
# Required env vars (in .env):
#   - ANTHROPIC_API_KEY or OPENAI_API_KEY
#   - PERPLEXITY_API_KEY
#   - FIRECRAWL_API_KEY
#   - SUPADATA_API_KEY

schema: "nika/workflow@0.5"
workflow: research-agent
description: "Multi-source web research agent"
provider: claude

mcp:
  perplexity:
    command: npx
    args: ["-y", "@perplexity-ai/mcp-server"]

  firecrawl:
    command: npx
    args: ["-y", "firecrawl-mcp"]

  supadata:
    command: npx
    args: ["-y", "@supadata/mcp"]

tasks:
  - id: input
    description: "Define research parameters"
    exec: |
      echo '{"topic": "AI QR code generation market trends 2025", "depth": "comprehensive"}'
    output:
      format: json

  - id: research
    description: "Deep research on a topic using all available tools"
    use:
      params: input
    agent:
      prompt: |
        You are an expert researcher with access to multiple web tools.

        RESEARCH TOPIC: {{use.params.topic}}
        RESEARCH DEPTH: {{use.params.depth}}

        AVAILABLE TOOLS:
        1. perplexity_search_web - AI-synthesized web search
        2. firecrawl_scrape - Extract content from URLs (use for articles, docs)
        3. firecrawl_search - Search and scrape in one step
        4. supadata_transcript - Get video transcripts (YouTube, etc.)
        5. supadata_scrape - Alternative web scraper

        RESEARCH STRATEGY:
        1. Start with perplexity_search_web for overview
        2. Identify key sources from search results
        3. Use firecrawl_scrape for detailed content extraction
        4. If video content is relevant, use supadata_transcript
        5. Synthesize all findings

        OUTPUT FORMAT (JSON):
        {
          "topic": "...",
          "executive_summary": "...",
          "key_findings": [
            {"finding": "...", "source": "...", "confidence": "high|medium|low"}
          ],
          "detailed_sections": [
            {"title": "...", "content": "...", "sources": ["..."]}
          ],
          "data_points": [
            {"metric": "...", "value": "...", "source": "..."}
          ],
          "sources_consulted": [
            {"url": "...", "type": "article|video|doc", "relevance": "high|medium|low"}
          ],
          "gaps_and_limitations": ["..."],
          "recommended_next_steps": ["..."]
        }

        When complete, output "RESEARCH_COMPLETE".

      provider: claude
      model: claude-sonnet-4-20250514
      mcp:
        - perplexity
        - firecrawl
        - supadata
      max_turns: 15
      stop_conditions:
        - "RESEARCH_COMPLETE"

flows:
  - source: input
    target: research
