# Claude Provider Test - Real API Tests
# Tests all verbs using Claude (claude-sonnet-4-20250514) as the provider
schema: "nika/workflow@0.5"
provider: claude

tasks:
  # ═══════════════════════════════════════════════════════════════════════════
  # TEST 1: exec: verb - Shell execution
  # ═══════════════════════════════════════════════════════════════════════════
  - id: test_exec
    exec: |
      echo '{"provider": "claude", "verb": "exec", "timestamp": "'$(date -u +%Y-%m-%dT%H:%M:%SZ)'"}'
    output:
      format: json

  # ═══════════════════════════════════════════════════════════════════════════
  # TEST 2: infer: verb - Claude Sonnet inference
  # ═══════════════════════════════════════════════════════════════════════════
  - id: test_infer_claude
    use:
      exec_result: test_exec
    infer:
      prompt: |
        You are being tested. Respond with EXACTLY this JSON and nothing else:
        {"status": "success", "verb": "infer", "model": "claude-sonnet", "math": 42}
      model: claude-sonnet-4-20250514

  # ═══════════════════════════════════════════════════════════════════════════
  # TEST 3: agent: verb - Multi-turn with Claude
  # ═══════════════════════════════════════════════════════════════════════════
  - id: test_agent_claude
    use:
      previous: test_infer_claude
    agent:
      prompt: |
        You are a test agent. Do exactly this:
        1. Say "STARTING CLAUDE TEST"
        2. Calculate: 23 * 17 = ?
        3. Say "CLAUDE TEST COMPLETE" and then "DONE"
      model: claude-sonnet-4-20250514
      max_turns: 3
      stop_conditions:
        - "DONE"

  # ═══════════════════════════════════════════════════════════════════════════
  # FINAL: Report
  # ═══════════════════════════════════════════════════════════════════════════
  - id: final_report
    use:
      exec: test_exec
      infer: test_infer_claude
      agent: test_agent_claude
    exec: |
      echo "=== CLAUDE PROVIDER TEST COMPLETE ==="
      echo "All verbs tested successfully with Claude Sonnet"

flows:
  - source: test_exec
    target: test_infer_claude
  - source: test_infer_claude
    target: test_agent_claude
  - source: test_agent_claude
    target: final_report
