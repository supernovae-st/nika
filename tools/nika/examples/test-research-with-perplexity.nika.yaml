# Research with Perplexity MCP Test
# Demonstrates web search + LLM synthesis pipeline
# Requires: ANTHROPIC_API_KEY, PERPLEXITY_API_KEY

schema: nika/workflow@0.5
workflow: research-with-perplexity
description: |
  Tests MCP integration with Perplexity for web research:
  1. Search the web for current information
  2. Synthesize findings with Claude
  3. Generate actionable insights

mcp:
  perplexity:
    command: npx
    args: ["-y", "perplexity-mcp"]
    env:
      PERPLEXITY_API_KEY: "${PERPLEXITY_API_KEY}"

tasks:
  # Step 1: Web search using agent with MCP
  - id: search_trends
    agent:
      prompt: "Use perplexity_search_web to search for 'QR code technology trends 2025'. Return only the search results summary."
      mcp:
        - perplexity
      max_turns: 3
      model: claude-sonnet-4-20250514

  # Step 2: Synthesize findings
  - id: synthesize
    use:
      results: search_trends
    infer:
      prompt: |
        Based on web research: {{use.results}}

        Synthesize into:
        1. Top 3 emerging trends
        2. Most promising business applications
        3. Potential challenges

  # Step 3: Generate recommendations
  - id: recommendations
    use:
      analysis: synthesize
    infer:
      prompt: |
        Based on analysis: {{use.analysis}}

        Generate 3 recommendations for qrcode-ai.com:
        - What to do
        - Why it matters
        - Impact (high/medium/low)

  # Step 4: Executive summary
  - id: summary
    use:
      analysis: synthesize
      recs: recommendations
    infer:
      prompt: |
        Synthesis: {{use.analysis}}
        Recommendations: {{use.recs}}

        Create a 100-word executive summary.
        End with "RESEARCH TEST: PASS".

flows:
  - source: search_trends
    target: synthesize
  - source: synthesize
    target: recommendations
  - source: recommendations
    target: summary
