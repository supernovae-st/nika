schema: nika/workflow@0.5
workflow: test-user-journey-blog-pipeline
description: |
  Real user journey: Blog content generation pipeline.
  Simulates a typical content creation workflow:
  1. Generate topic ideas
  2. Create outline
  3. Write content
  4. Format as markdown

tasks:
  # Step 1: Generate topic ideas based on a theme
  - id: generate_topics
    infer: |
      Generate 3 blog post topic ideas about "AI-powered workflow automation".
      Return as a numbered list. Each topic should be specific and actionable.
      Format: 1. Topic Title - Brief description

  # Step 2: Select and outline the first topic
  - id: create_outline
    use:
      topics: generate_topics
    infer:
      prompt: |
        Given these topic ideas:
        {{use.topics}}

        Select the first topic and create a detailed outline with:
        - Introduction hook
        - 3-4 main sections with bullet points
        - Conclusion with call-to-action

        Return the outline in markdown format.

  # Step 3: Write the introduction section
  - id: write_intro
    use:
      outline: create_outline
    infer:
      prompt: |
        Based on this outline:
        {{use.outline}}

        Write an engaging introduction paragraph (150-200 words) that:
        - Hooks the reader with a surprising fact or question
        - Establishes the problem being solved
        - Previews the value they'll get

        Return only the introduction paragraph.

  # Step 4: Assemble final draft with metadata
  - id: assemble_draft
    use:
      outline: create_outline
      intro: write_intro
    infer:
      prompt: |
        Assemble a blog post draft with this structure:

        # [Title from outline]

        {{use.intro}}

        ## Outline
        {{use.outline}}

        ---
        **Status:** Draft
        **Generated by:** Nika Workflow Engine

        Return the complete markdown document.

  # Step 5: Validate the output structure
  - id: validate_output
    use:
      draft: assemble_draft
    exec: |
      echo "=== Blog Pipeline Validation ==="
      echo "Draft length: $(echo "{{use.draft}}" | wc -c) characters"
      echo "Contains title: $(echo "{{use.draft}}" | grep -c '^# ')"
      echo "Contains sections: $(echo "{{use.draft}}" | grep -c '^## ')"
      echo "=== Validation Complete ==="

flows:
  - source: generate_topics
    target: create_outline
  - source: create_outline
    target: write_intro
  - source: create_outline
    target: assemble_draft
  - source: write_intro
    target: assemble_draft
  - source: assemble_draft
    target: validate_output
