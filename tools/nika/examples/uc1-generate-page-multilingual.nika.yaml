# UC1: Multi-Locale Page Generation
# Generates a product page across 5 locales in parallel
#
# DAG: page_key → [gen_fr, gen_es, gen_de, gen_ja, gen_pt] → report
#
schema: "nika/workflow@0.2"
provider: claude

mcp:
  novanet:
    command: /Users/thibaut/supernovae-st/supernovae-agi/novanet-dev/tools/novanet-mcp/target/release/novanet-mcp
    args: []
    env:
      NOVANET_MCP_NEO4J_URI: bolt://localhost:7687
      NOVANET_MCP_NEO4J_USER: neo4j
      NOVANET_MCP_NEO4J_PASSWORD: novanetpassword

tasks:
  # ─────────────────────────────────────────────────────────────────
  # PHASE 1: Input
  # ─────────────────────────────────────────────────────────────────

  - id: page_key
    exec:
      command: "echo qr-code-art"

  # ─────────────────────────────────────────────────────────────────
  # PHASE 2: Parallel locale generation (fan-out)
  # ─────────────────────────────────────────────────────────────────

  - id: gen_fr
    use:
      page: page_key
    invoke:
      mcp: novanet
      tool: novanet_generate
      params:
        focus_key: "{{use.page}}"
        locale: "fr-FR"
        mode: "page"
        token_budget: 50000
        include_examples: true
    output:
      format: json

  - id: gen_es
    use:
      page: page_key
    invoke:
      mcp: novanet
      tool: novanet_generate
      params:
        focus_key: "{{use.page}}"
        locale: "es-ES"
        mode: "page"
        token_budget: 50000
        include_examples: true
    output:
      format: json

  - id: gen_de
    use:
      page: page_key
    invoke:
      mcp: novanet
      tool: novanet_generate
      params:
        focus_key: "{{use.page}}"
        locale: "de-DE"
        mode: "page"
        token_budget: 50000
        include_examples: true
    output:
      format: json

  - id: gen_ja
    use:
      page: page_key
    invoke:
      mcp: novanet
      tool: novanet_generate
      params:
        focus_key: "{{use.page}}"
        locale: "ja-JP"
        mode: "page"
        token_budget: 50000
        include_examples: true
    output:
      format: json

  - id: gen_pt
    use:
      page: page_key
    invoke:
      mcp: novanet
      tool: novanet_generate
      params:
        focus_key: "{{use.page}}"
        locale: "pt-BR"
        mode: "page"
        token_budget: 50000
        include_examples: true
    output:
      format: json

  # ─────────────────────────────────────────────────────────────────
  # PHASE 3: Generation report (fan-in)
  # ─────────────────────────────────────────────────────────────────

  - id: report
    use:
      result_fr: gen_fr
      result_es: gen_es
      result_de: gen_de
      result_ja: gen_ja
      result_pt: gen_pt
    infer:
      prompt: |
        Generate a deployment summary for page: qr-code-art

        RESULTS:
        - fr-FR: {{use.result_fr}}
        - es-ES: {{use.result_es}}
        - de-DE: {{use.result_de}}
        - ja-JP: {{use.result_ja}}
        - pt-BR: {{use.result_pt}}

        Summarize: total blocks, token usage, failures, time saved vs manual.

flows:
  - source: page_key
    target: [gen_fr, gen_es, gen_de, gen_ja, gen_pt]
  - source: [gen_fr, gen_es, gen_de, gen_ja, gen_pt]
    target: report
